import{u as W,a as $,g as D,E as G,b as H,c as J,d as K,e as X,f as Y,h as Z,i as ee,j as te,_ as oe}from"./index-BWM47CVy.js";/* empty css               */import{l as ae}from"./logo-D9xg-r66.js";import{d as se,aA as ne,b as r,s as le,r as g,f as re,an as b,c as ue,o as u,a as s,V as t,O as o,S as ie,u as ce,M as v,Q as w}from"./vendor-Cmg6szqf.js";import"./utils-Bti12kXR.js";import"./elementPlusIcons-BUCPW4pk.js";const de={class:"login-container"},pe={class:"login-form"},me={class:"logo",tabindex:"-1"},_e={class:"image-slot"},fe=se({__name:"Login",setup(ge){const y=ne(),i=W(),c=$(),U=r(()=>c.authMeta.enableRegister),I=r(()=>c.authMeta.disablePasswordLogin),k=r(()=>c.authMeta.disablePasswordRegister),R=r(()=>c.authMeta.enableAuth0),B=r(()=>I.value&&k.value),S=(a,e,n)=>{if(ee(e))return n(new Error("请输入用户名"));n()},q=(a,e,n)=>{const l=te(e);if(l)return n(l);n()},V=le(null),C=g({username:"",password:""}),h=g(""),d=g({}),z={submitBtn:!1,submitText:"登录",emptyBtn:!1,column:{username:{span:24,label:"用户名",prefixIcon:"el-icon-user",autocomplete:"off",rules:[{required:!0,message:"请输入用户名",trigger:"blur"},{validator:S,trigger:"blur"}]},password:{type:"password",span:24,label:"密码",prefixIcon:"el-icon-lock",autocomplete:"off",rules:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:q,trigger:"blur"}]}}},M=()=>{V.value?.submit()},A=async(a,e)=>{try{await i.login(a),await i.getUserInfo(),await y.push({path:h.value||"/",query:d.value})}catch(n){console.error(n)}finally{e()}},p=g("one-click"),T=()=>{const a=new URL(window.location.href);a.pathname="/api/auth/register",window.location.href=a.href},N=()=>{const a=new URL(window.location.href);a.pathname="/api/auth/login",window.location.href=a.href},O=async()=>{try{(d.value?.state?.startsWith("auth0_login_")||d.value?.state?.startsWith("oidc_login_"))&&(await i.getUserInfo(),await y.push({path:h.value||"/",query:{}}))}catch(a){console.error(a),await i.logout()}};return re(async()=>{R.value?p.value="one-click":p.value="legacy";const a=y.currentRoute.value.query;h.value=a?.redirect,d.value=D(a),await O()}),(a,e)=>{const n=b("icon-picture"),l=G,j=H,L=b("Position"),m=Y,_=X,E=b("Lock"),x=K,Q=b("avue-form"),P=J,F=Z;return u(),ue("div",de,[s("div",pe,[s("div",null,[s("div",me,[t(j,{src:ce(ae),tabindex:"-1",lazy:""},{placeholder:o(()=>e[3]||(e[3]=[s("div",{class:"image-slot"},[ie(" Loading"),s("span",{class:"dot"},"...")],-1)])),error:o(()=>[s("div",_e,[t(l,null,{default:o(()=>[t(n)]),_:1})])]),_:1},8,["src"])]),e[4]||(e[4]=s("h1",{class:"logo-title"}," RSS Impact ",-1))]),t(F,{modelValue:p.value,"onUpdate:modelValue":e[2]||(e[2]=f=>p.value=f)},{default:o(()=>[B.value?w("",!0):(u(),v(P,{key:0,label:"表单登录",name:"legacy"},{default:o(()=>[t(Q,{ref_key:"formRef",ref:V,modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=f=>C.value=f),option:z,onSubmit:A},{"menu-form":o(({size:f})=>[t(x,{class:"button-row",justify:"space-between"},{default:o(()=>[t(_,{span:11},{default:o(()=>[k.value?w("",!0):(u(),v(m,{key:0,type:"success",class:"register-button",size:"large",onClick:e[0]||(e[0]=be=>a.$router.push("/register"))},{default:o(()=>[t(l,null,{default:o(()=>[t(L)]),_:1}),e[5]||(e[5]=s("span",null,"前往注册",-1))]),_:1,__:[5]}))]),_:1}),t(_,{span:11},{default:o(()=>[t(m,{type:"primary","native-type":"submit",class:"login-button",size:"large",onClick:M},{default:o(()=>[t(l,null,{default:o(()=>[t(E)]),_:1}),e[6]||(e[6]=s("span",null,"登录",-1))]),_:1,__:[6]})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})),R.value?(u(),v(P,{key:1,label:"一键登录",name:"one-click"},{default:o(()=>[t(x,{class:"one-click-button-row",justify:"space-between"},{default:o(()=>[t(_,{span:11},{default:o(()=>[U.value?(u(),v(m,{key:0,type:"success",size:"large",onClick:T},{default:o(()=>[t(l,null,{default:o(()=>[t(L)]),_:1}),e[7]||(e[7]=s("span",null,"一键注册",-1))]),_:1,__:[7]})):w("",!0)]),_:1}),t(_,{span:11},{default:o(()=>[t(m,{type:"primary",size:"large",onClick:N},{default:o(()=>[t(l,null,{default:o(()=>[t(E)]),_:1}),e[8]||(e[8]=s("span",null,"一键登录",-1))]),_:1,__:[8]})]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1},8,["modelValue"])])])}}}),Ve=oe(fe,[["__scopeId","data-v-431e8226"]]);export{Ve as default};
//# sourceMappingURL=Login-D5yBttSg.js.map
