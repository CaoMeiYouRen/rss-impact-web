import{B as R,w as $,f as h,z as N,k as S,l as b,C as A,c as M,d as j,e as I,D as L,n as O,_ as T}from"./index-707xuYzG.js";/* empty css               */import{u as U,i as z,a as P,b as Q,c as q,d as F,E as G}from"./echarts-CYaxeE_y.js";import{g as k}from"./utils-DdfcVxQu.js";import{r as x,b as B,w as H,f as J,d as K,o as W,c as X,U as a,M as o,ai as Y,a as V,R as D,u as w,k as Z}from"./vendor-QoiXRGgJ.js";import"./elementPlusIcons-29F-OX7S.js";function ee(E,i,f){const _=x(),{loading:n,list:d,getOption:c,page:e,getList:y,option:g}=R(_,E,void 0,!1);e.value.pageSize=1e3;const m=$().hour(0).minute(0).second(0).millisecond(0),C=m.add(-31,"day"),r=m.add(1,"day").add(-1,"millisecond"),l=x([C.toDate(),r.toDate()]),p=B(()=>{var t;return((t=g.value.column)==null?void 0:t.filter(u=>f.includes((u==null?void 0:u.prop)||"")))||[]}),v=B(()=>({xAxis:{type:"category",data:d.value.map(t=>k(t,i))},yAxis:{type:"value"},series:p.value.map(t=>({data:d.value.map(u=>k(u,(t==null?void 0:t.prop)||"")),type:"line",name:t.label})),tooltip:{trigger:"axis"},legend:{data:p.value.map(t=>t.label),orient:"vertical",right:10,top:"center"}})),s=async()=>{const t=l.value[0],u=l.value[1];n.value=!0,await y({date:{$op:"Between",value:[t,u]}},{rawDate:"ASC",createdAt:void 0,id:void 0}),n.value=!1};return H([l],async()=>{await s()}),J(async()=>{await c(),await s()}),{loading:n,list:d,datetimerange:l,chartOption:v,onSearch:s}}const te=K({__name:"DailyCount",setup(E){U([z,P,Q,q,F]);const{datetimerange:i,chartOption:f,onSearch:_}=ee("daily-count","date",["articleCount","resourceCount","webhookLogCount","feedCount","categoryCount","hookCount","customQueryCount","proxyConfigCount","userCount"]),n=x(30);async function d(){try{await N.confirm(`确定重新统计 ${n.value} 天内的日志吗？此操作可以修复错误的统计数据，但不可回退！`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await S.api.dailyCountReCount({dayNum:n.value}),b.success("重新统计成功"),await _()}catch(c){if(console.error(c),c==="cancel")return;b.error("重新统计失败")}}return(c,e)=>{const y=A,g=Y("Refresh"),m=M,C=j,r=I,l=h,p=L,v=O;return W(),X("div",null,[a(l,{gutter:20,justify:"end"},{default:o(()=>[a(r,{sm:24,md:12,lg:8},{default:o(()=>[e[3]||(e[3]=V("label",null,"天数：",-1)),a(y,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=s=>n.value=s),min:1,max:365},null,8,["modelValue"]),e[4]||(e[4]=D("   ")),a(C,{type:"warning",onClick:d},{default:o(()=>[a(m,null,{default:o(()=>[a(g)]),_:1}),e[2]||(e[2]=D("   重新统计 "))]),_:1})]),_:1})]),_:1}),a(l,{gutter:20},{default:o(()=>[a(r,{sm:24},{default:o(()=>[e[5]||(e[5]=V("label",null,"时间范围：",-1)),a(p,{modelValue:w(i),"onUpdate:modelValue":e[1]||(e[1]=s=>Z(i)?i.value=s:null),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),a(r,{sm:24},{default:o(()=>[a(w(G),{class:"chart",option:w(f)},null,8,["option"])]),_:1}),a(r,{sm:24},{default:o(()=>[a(v,{model:"daily-count"})]),_:1})]),_:1})])}}}),re=T(te,[["__scopeId","data-v-6f3a90b0"]]);export{re as default};
//# sourceMappingURL=DailyCount-C-Y4StZp.js.map
