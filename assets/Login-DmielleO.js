import{u as $,a as W,g as D,E as G,b as H,c as J,d as K,e as X,f as Y,h as Z,i as ee,j as te,_ as oe}from"./index-D60CcYgm.js";/* empty css               */import{l as ae}from"./logo-ZVh8FKNo.js";import{d as se,b as r,s as ne,r as _,f as le,o as i,c as re,a as n,U as o,M as a,u as ie,az as ue,ai as g,R as ce,L as b,Q as w}from"./vendor-BzLXxd9Y.js";import"./utils-JL75IvXN.js";import"./elementPlusIcons-DGssvR7c.js";const de={class:"login-container"},pe={class:"login-form"},me={class:"logo",tabindex:"-1"},fe={class:"image-slot"},_e=se({__name:"Login",setup(ge){const v=ue(),u=$(),c=W(),x=r(()=>c.authMeta.enableRegister),I=r(()=>c.authMeta.disablePasswordLogin),k=r(()=>c.authMeta.disablePasswordRegister),R=r(()=>c.authMeta.enableAuth0),z=r(()=>I.value&&k.value),B=(t,e,s)=>{if(ee(e))return s(new Error("请输入用户名"));s()},M=(t,e,s)=>{const l=te(e);if(l)return s(l);s()},L=ne(null),C=_({username:"",password:""}),y=_(""),h=_({}),S={submitBtn:!1,submitText:"登录",emptyBtn:!1,column:{username:{span:24,label:"用户名",prefixIcon:"el-icon-user",autocomplete:"off",rules:[{required:!0,message:"请输入用户名",trigger:"blur"},{validator:B,trigger:"blur"}]},password:{type:"password",span:24,label:"密码",prefixIcon:"el-icon-lock",autocomplete:"off",rules:[{required:!0,message:"请输入密码",trigger:"blur"},{validator:M,trigger:"blur"}]}}},T=()=>{var t;(t=L.value)==null||t.submit()},q=async(t,e)=>{try{await u.login(t),await u.getUserInfo(),await v.push({path:y.value||"/",query:h.value})}catch(s){console.error(s)}finally{e()}},d=_("one-click"),A=()=>{const t=new URL(window.location.href);t.pathname="/api/auth/register",t.searchParams.set("redirect",window.location.origin),window.location.href=t.href},N=()=>{const t=new URL(window.location.href);t.pathname="/api/auth/login",t.searchParams.set("redirect",window.location.origin),window.location.href=t.href},j=async()=>{var t,e;try{(e=(t=h.value)==null?void 0:t.state)!=null&&e.startsWith("auth0_login_")&&(await u.getUserInfo(),await v.push({path:y.value||"/",query:{}}))}catch(s){console.error(s),await u.logout()}};return le(async()=>{R.value?d.value="one-click":d.value="legacy";const t=v.currentRoute.value.query;y.value=t==null?void 0:t.redirect,h.value=D(t),await j()}),(t,e)=>{const s=g("icon-picture"),l=J,O=G,V=g("Position"),p=K,m=X,P=g("Lock"),E=Y,Q=g("avue-form"),U=Z,F=H;return i(),re("div",de,[n("div",pe,[n("div",null,[n("div",me,[o(O,{src:ie(ae),tabindex:"-1",lazy:""},{placeholder:a(()=>e[3]||(e[3]=[n("div",{class:"image-slot"},[ce(" Loading"),n("span",{class:"dot"},"...")],-1)])),error:a(()=>[n("div",fe,[o(l,null,{default:a(()=>[o(s)]),_:1})])]),_:1},8,["src"])]),e[4]||(e[4]=n("h1",{class:"logo-title"}," RSS Impact ",-1))]),o(F,{modelValue:d.value,"onUpdate:modelValue":e[2]||(e[2]=f=>d.value=f)},{default:a(()=>[z.value?w("",!0):(i(),b(U,{key:0,label:"表单登录",name:"legacy"},{default:a(()=>[o(Q,{ref_key:"formRef",ref:L,modelValue:C.value,"onUpdate:modelValue":e[1]||(e[1]=f=>C.value=f),option:S,onSubmit:q},{"menu-form":a(({size:f})=>[o(E,{class:"button-row",justify:"space-between"},{default:a(()=>[o(m,{span:11},{default:a(()=>[k.value?w("",!0):(i(),b(p,{key:0,type:"success",class:"register-button",size:"large",onClick:e[0]||(e[0]=be=>t.$router.push("/register"))},{default:a(()=>[o(l,null,{default:a(()=>[o(V)]),_:1}),e[5]||(e[5]=n("span",null,"前往注册",-1))]),_:1}))]),_:1}),o(m,{span:11},{default:a(()=>[o(p,{type:"primary","native-type":"submit",class:"login-button",size:"large",onClick:T},{default:a(()=>[o(l,null,{default:a(()=>[o(P)]),_:1}),e[6]||(e[6]=n("span",null,"登录",-1))]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1})),R.value?(i(),b(U,{key:1,label:"一键登录",name:"one-click"},{default:a(()=>[o(E,{class:"one-click-button-row",justify:"space-between"},{default:a(()=>[o(m,{span:11},{default:a(()=>[x.value?(i(),b(p,{key:0,type:"success",size:"large",onClick:A},{default:a(()=>[o(l,null,{default:a(()=>[o(V)]),_:1}),e[7]||(e[7]=n("span",null,"一键注册",-1))]),_:1})):w("",!0)]),_:1}),o(m,{span:11},{default:a(()=>[o(p,{type:"primary",size:"large",onClick:N},{default:a(()=>[o(l,null,{default:a(()=>[o(P)]),_:1}),e[8]||(e[8]=n("span",null,"一键登录",-1))]),_:1})]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1},8,["modelValue"])])])}}}),Le=oe(_e,[["__scopeId","data-v-8ddd6ce2"]]);export{Le as default};
//# sourceMappingURL=Login-DmielleO.js.map
