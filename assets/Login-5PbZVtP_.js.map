{"version":3,"file":"Login-5PbZVtP_.js","sources":["../../src/views/Login.vue"],"sourcesContent":["<template>\n    <div class=\"login-container\">\n        <div class=\"login-form\">\n            <div>\n                <div class=\"logo\" tabindex=\"-1\">\n                    <el-image\n                        :src=\"logo\"\n                        tabindex=\"-1\"\n                        lazy\n                    >\n                        <template #placeholder>\n                            <div class=\"image-slot\">\n                                Loading<span class=\"dot\">...</span>\n                            </div>\n                        </template>\n                        <template #error>\n                            <div class=\"image-slot\">\n                                <el-icon><icon-picture /></el-icon>\n                            </div>\n                        </template>\n                    </el-image>\n                </div>\n                <h1 class=\"logo-title\">\n                    RSS Impact\n                </h1>\n            </div>\n            <el-tabs v-model=\"activeTab\">\n                <el-tab-pane\n                    v-if=\"!disableForm\"\n                    label=\"表单登录\"\n                    name=\"legacy\"\n                >\n                    <avue-form\n                        ref=\"formRef\"\n                        v-model=\"loginForm\"\n                        :option=\"option\"\n                        @submit=\"submit\"\n                    >\n                        <template #menu-form=\"{size}\">\n                            <el-row class=\"button-row\" justify=\"space-between\">\n                                <el-col :span=\"11\">\n                                    <el-button\n                                        v-if=\"!disablePasswordRegister\"\n                                        type=\"success\"\n                                        class=\"register-button\"\n                                        size=\"large\"\n                                        @click=\"$router.push('/register')\"\n                                    >\n                                        <el-icon>\n                                            <Position />\n                                        </el-icon>\n                                        <span>前往注册</span>\n                                    </el-button>\n                                </el-col>\n                                <el-col :span=\"11\">\n                                    <el-button\n                                        type=\"primary\"\n                                        native-type=\"submit\"\n                                        class=\"login-button\"\n                                        size=\"large\"\n                                        @click=\"onLogin\"\n                                    >\n                                        <el-icon>\n                                            <Lock />\n                                        </el-icon>\n                                        <span>登录</span>\n                                    </el-button>\n                                </el-col>\n                            </el-row>\n                        </template>\n                    </avue-form>\n                </el-tab-pane>\n                <el-tab-pane\n                    v-if=\"enableAuth0\"\n                    label=\"一键登录\"\n                    name=\"one-click\"\n                >\n                    <el-row class=\"one-click-button-row\" justify=\"space-between\">\n                        <el-col :span=\"11\">\n                            <el-button\n                                v-if=\"enableRegister\"\n                                type=\"success\"\n                                size=\"large\"\n                                @click=\"onOneClickRegister\"\n                            >\n                                <el-icon>\n                                    <Position />\n                                </el-icon>\n                                <span>一键注册</span>\n                            </el-button>\n                        </el-col>\n                        <el-col :span=\"11\">\n                            <el-button\n                                type=\"primary\"\n                                size=\"large\"\n                                @click=\"onOneClickLogin\"\n                            >\n                                <el-icon>\n                                    <Lock />\n                                </el-icon>\n                                <span>一键登录</span>\n                            </el-button>\n                        </el-col>\n                    </el-row>\n                </el-tab-pane>\n            </el-tabs>\n        </div>\n    </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { computed, onMounted, ref, shallowRef } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { LoginDto } from '@/api/api'\nimport { baseValidatePassword, isValidUsername } from '@/utils/validate'\nimport { useUserStore } from '@/store/modules/user'\nimport logo from '@/assets/images/logo.png'\nimport { AvueFormOption } from '@/interfaces/avue'\nimport { useAppStore } from '@/store/modules/app'\nimport { Dictionary, getOtherQuery } from '@/utils/helper'\n\nconst router = useRouter()\nconst userStore = useUserStore()\nconst state = useAppStore()\n\nconst enableRegister = computed(() => state.authMeta.enableRegister)\nconst disablePasswordLogin = computed(() => state.authMeta.disablePasswordLogin)\nconst disablePasswordRegister = computed(() => state.authMeta.disablePasswordRegister)\nconst enableAuth0 = computed(() => state.authMeta.enableAuth0)\n\nconst disableForm = computed(() => disablePasswordLogin.value && disablePasswordRegister.value)\n\nconst validateUsername = (rule: any, value: string, callback: (error?: Error) => void) => {\n    if (isValidUsername(value)) {\n        return callback(new Error('请输入用户名'))\n    }\n    callback()\n}\nconst validatePassword = (rule: any, value: string, callback: (error?: Error) => void) => {\n    const error = baseValidatePassword(value)\n    if (error) {\n        return callback(error)\n    }\n    callback()\n}\nconst formRef = shallowRef<any>(null)\nconst loginForm = ref<LoginDto>({\n    username: '',\n    password: '',\n})\nconst redirect = ref('')\nconst otherQuery = ref<Dictionary<string>>({})\n\nconst option: AvueFormOption = {\n    submitBtn: false,\n    submitText: '登录',\n    emptyBtn: false,\n    column: {\n        username: {\n            span: 24,\n            label: '用户名',\n            prefixIcon: 'el-icon-user',\n            autocomplete: 'off',\n            rules: [\n                { required: true, message: '请输入用户名', trigger: 'blur' },\n                { validator: validateUsername, trigger: 'blur' },\n            ],\n        },\n        password: {\n            type: 'password',\n            span: 24,\n            label: '密码',\n            prefixIcon: 'el-icon-lock',\n            autocomplete: 'off',\n            rules: [\n                { required: true, message: '请输入密码', trigger: 'blur' },\n                { validator: validatePassword, trigger: 'blur' },\n            ],\n        },\n    } as any,\n}\n\nconst onLogin = () => {\n    formRef.value?.submit()\n}\n\nconst submit = async (form: LoginDto, done: () => void) => {\n    try {\n        await userStore.login(form)\n        await userStore.getUserInfo()\n        await router.push({\n            path: redirect.value || '/',\n            query: otherQuery.value,\n        })\n    } catch (error) {\n        console.error(error)\n    } finally {\n        done()\n    }\n}\n\nconst clearForm = () => {\n    loginForm.value = {\n        username: '',\n        password: '',\n    }\n}\n// one-click 一键登录\n// legacy 表单登录\nconst activeTab = ref('one-click')\n\nconst onOneClickRegister = () => {\n    const url = new URL(window.location.href)\n    url.pathname = '/api/auth/register'\n    // url.searchParams.set('redirect', window.location.origin)\n    window.location.href = url.href\n}\n\nconst onOneClickLogin = () => {\n    const url = new URL(window.location.href)\n    url.pathname = '/api/auth/login'\n    // url.searchParams.set('redirect', window.location.origin)\n    window.location.href = url.href\n}\n\nconst onAuth0LoginCallback = async () => {\n    try {\n        if (otherQuery.value?.state?.startsWith('auth0_login_') || otherQuery.value?.state?.startsWith('oidc_login_')) { // 如果从 auth0 回调\n            await userStore.getUserInfo()\n            await router.push({\n                path: redirect.value || '/',\n                query: {},\n            })\n        }\n    } catch (error) {\n        console.error(error)\n        await userStore.logout()\n    }\n}\n\nonMounted(async () => {\n    if (enableAuth0.value) {\n        activeTab.value = 'one-click'\n    } else {\n        activeTab.value = 'legacy'\n    }\n    const query = router.currentRoute.value.query as Dictionary<string>\n    redirect.value = query?.redirect\n    otherQuery.value = getOtherQuery(query)\n    await onAuth0LoginCallback()\n})\n\n</script>\n\n<style lang=\"scss\" scoped>\n.login-container {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    width: 100%;\n    height: 100vh;\n    background: linear-gradient(135deg, #83a4d4, #b6fbff);\n\n    .login-form {\n        background: rgb(255 255 255 / 1);\n        padding: 40px;\n        border-radius: 10px;\n        box-shadow: 0 10px 20px rgb(0 0 0 / 0.1);\n        width: 400px;\n        text-align: center;\n\n        .logo {\n            margin: 0 auto 20px;\n            width: 150px;\n        }\n\n        .logo-title {\n            color: rgb(20 34 51);\n        }\n\n        .el-form-item {\n            margin-bottom: 20px;\n        }\n\n        .button-row {\n            // margin-top: 20px;\n            margin-bottom: 20px;\n        }\n\n        .one-click-button-row {\n            margin-top: 30px;\n            margin-bottom: 20px;\n        }\n\n        .el-button {\n            width: 100%;\n            border-radius: 5px;\n            transition: background-color 0.3s ease;\n\n            // &:hover {\n            //     background-color: #66bb6a;\n            // }\n        }\n\n        .clear-button {\n            background-color: #f56c6c;\n            border-color: #f56c6c;\n\n            &:hover {\n                background-color: #f78989;\n                border-color: #f78989;\n            }\n        }\n\n        .login-button {\n            // background-color: #409eff;\n            // border-color: #409eff;\n\n            // &:hover {\n            //     background-color: #66b1ff;\n            //     border-color: #66b1ff;\n            // }\n        }\n\n        .register-button {\n            // margin-top: 20px;\n            // background-color: #42b983;\n            // border-color: #42b983;\n\n            // &:hover {\n            //     background-color: #3da87a;\n            //     border-color: #3da87a;\n            // }\n        }\n    }\n}\n</style>\n"],"names":["router","useRouter","userStore","useUserStore","state","useAppStore","enableRegister","computed","disablePasswordLogin","disablePasswordRegister","enableAuth0","disableForm","validateUsername","rule","value","callback","isValidUsername","validatePassword","error","baseValidatePassword","formRef","shallowRef","loginForm","ref","redirect","otherQuery","option","onLogin","submit","form","done","activeTab","onOneClickRegister","url","onOneClickLogin","onAuth0LoginCallback","onMounted","query","getOtherQuery","_openBlock","_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","_createVNode","_component_el_image","_unref","logo","_cache","_hoisted_4","_component_el_icon","_component_icon_picture","_component_el_tabs","$event","_createBlock","_component_el_tab_pane","_component_avue_form","_withCtx","size","_component_el_row","_component_el_col","_component_el_button","$router","_component_Position","_component_Lock"],"mappings":"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"}