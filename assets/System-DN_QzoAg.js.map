{"version":3,"file":"System-DN_QzoAg.js","sources":["../../src/views/admin/System.vue"],"sourcesContent":["<template>\n    <div>\n        <el-row :gutter=\"20\">\n            <el-col\n                :sm=\"24\"\n                :md=\"12\"\n                :lg=\"8\"\n            >\n                <CrudForm\n                    ref=\"formDom\"\n                    v-model=\"databaseInfo\"\n                    method=\"GET\"\n                    url=\"/system/getDatabaseInfo\"\n                />\n                <el-tooltip\n                    class=\"box-item\"\n                    effect=\"dark\"\n                    content=\"触发 sqlite 的 VACUUM 命令以释放未使用空间\"\n                    placement=\"bottom\"\n                >\n                    <el-button\n                        v-if=\"enableSqliteVacuum\"\n                        type=\"primary\"\n                        @click=\"onCompactDatabase\"\n                    >\n                        压缩数据库\n                    </el-button>\n                </el-tooltip>\n                <el-tooltip\n                    class=\"box-item\"\n                    effect=\"dark\"\n                    content=\"禁用所有不包含 Hook 和 自定义查询的订阅\"\n                    placement=\"bottom\"\n                >\n                    <el-button\n                        v-if=\"enableSqliteVacuum\"\n                        type=\"primary\"\n                        @click=\"onDisableEmptyFeeds\"\n                    >\n                        禁用空订阅\n                    </el-button>\n                </el-tooltip>\n            </el-col>\n            <el-col\n                :sm=\"24\"\n                :md=\"12\"\n                :lg=\"8\"\n            >\n                <CrudForm method=\"GET\" url=\"/system/getOsInfo\" />\n            </el-col>\n        </el-row>\n    </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref, computed, shallowRef } from 'vue'\nimport { ElMessage, ElMessageBox } from 'element-plus'\nimport { DatabaseInfoDto } from '@/api/api'\nimport { api } from '@/api'\n\nconst formDom = shallowRef()\n\nconst databaseInfo = ref<DatabaseInfoDto>({} as any)\n\nconst enableSqliteVacuum = computed(() => databaseInfo.value.type === 'sqlite')\n// 压缩数据库\nconst onCompactDatabase = async () => {\n    try {\n        await api.api.systemSqliteVacuum()\n        ElMessage.success('执行成功！')\n        if (formDom.value) {\n            await formDom.value.initForm()\n        }\n    } catch (error) {\n        ElMessage.error('执行失败！')\n        console.error(error)\n    }\n}\n\n// 禁用空订阅\nconst onDisableEmptyFeeds = async () => {\n    try {\n        // 警告\n        const action = await ElMessageBox.confirm('确定禁用所有不包含 Hook 和 自定义查询的订阅吗？', '提示', {\n            confirmButtonText: '确定',\n            cancelButtonText: '取消',\n            type: 'warning',\n        })\n        if (action === 'confirm') {\n            await api.api.systemDisableEmptyFeeds()\n            ElMessage.success('执行成功！')\n        }\n    } catch (error) {\n        ElMessage.error('执行失败！')\n        console.error(error)\n    }\n}\n\n</script>\n\n<!-- <style lang=\"scss\" scoped>\n</style> -->\n"],"names":["formDom","shallowRef","databaseInfo","ref","enableSqliteVacuum","computed","onCompactDatabase","api","ElMessage","error","onDisableEmptyFeeds","ElMessageBox"],"mappings":"4UA4DA,MAAMA,EAAUC,EAAW,EAErBC,EAAeC,EAAqB,EAAS,EAE7CC,EAAqBC,EAAS,IAAMH,EAAa,MAAM,OAAS,QAAQ,EAExEI,EAAoB,SAAY,CAC9B,GAAA,CACM,MAAAC,EAAI,IAAI,mBAAmB,EACjCC,EAAU,QAAQ,OAAO,EACrBR,EAAQ,OACF,MAAAA,EAAQ,MAAM,SAAS,QAE5BS,EAAO,CACZD,EAAU,MAAM,OAAO,EACvB,QAAQ,MAAMC,CAAK,CAAA,CAE3B,EAGMC,EAAsB,SAAY,CAChC,GAAA,CAEe,MAAMC,EAAa,QAAQ,8BAA+B,KAAM,CAC3E,kBAAmB,KACnB,iBAAkB,KAClB,KAAM,SAAA,CACT,IACc,YACL,MAAAJ,EAAI,IAAI,wBAAwB,EACtCC,EAAU,QAAQ,OAAO,SAExBC,EAAO,CACZD,EAAU,MAAM,OAAO,EACvB,QAAQ,MAAMC,CAAK,CAAA,CAE3B"}