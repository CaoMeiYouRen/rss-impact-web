import{B as $,w as h,d as A,e as N,C as R,f as S,E as L,D as j,q as I,A as M,l as O,m as b,_ as T}from"./index-COtLEBgB.js";/* empty css               */import{u as U,i as q,a as z,b as K,c as P,d as Q,E as Y}from"./echarts-wEwGZ9Xl.js";import{g as B}from"./utils-D2MEr7kw.js";import{r as x,b as V,w as F,f as G,d as H,c as J,K as t,L as n,af as W,o as X,a as k,Y as D,k as Z,u as w}from"./vendor-Dbhp6dwi.js";import"./elementPlusIcons-DiszcvWH.js";function ee(E,r,p){const f=x(),{loading:o,list:i,getOption:d,page:e,getList:_,option:y}=$(f,E,void 0,!1);e.value.pageSize=1e3;const c=h().hour(0).minute(0).second(0).millisecond(0),g=c.add(-31,"day"),u=c.add(1,"day").add(-1,"millisecond"),l=x([g.toDate(),u.toDate()]),m=V(()=>y.value.column?.filter(a=>p.includes(a?.prop||""))||[]),C=V(()=>({xAxis:{type:"category",data:i.value.map(a=>B(a,r))},yAxis:{type:"value"},series:m.value.map(a=>({data:i.value.map(v=>B(v,a?.prop||"")),type:"line",name:a.label})),tooltip:{trigger:"axis"},legend:{data:m.value.map(a=>a.label),orient:"vertical",right:10,top:"center"}})),s=async()=>{const a=l.value[0],v=l.value[1];o.value=!0,await _({date:{$op:"Between",value:[a,v]}},{rawDate:"ASC",createdAt:void 0,id:void 0}),o.value=!1};return F([l],async()=>{await s()}),G(async()=>{await d(),await s()}),{loading:o,list:i,datetimerange:l,chartOption:C,onSearch:s}}const te=H({__name:"DailyCount",setup(E){U([q,z,K,P,Q]);const{datetimerange:r,chartOption:p,onSearch:f}=ee("daily-count","date",["articleCount","resourceCount","webhookLogCount","feedCount","categoryCount","hookCount","customQueryCount","proxyConfigCount","userCount"]),o=x(30);async function i(){try{await M.confirm(`确定重新统计 ${o.value} 天内的日志吗？此操作可以修复错误的统计数据，但不可回退！`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O.api.dailyCountReCount({dayNum:o.value}),b.success("重新统计成功"),await f()}catch(d){if(console.error(d),d==="cancel")return;b.error("重新统计失败")}}return(d,e)=>{const _=R,y=W("Refresh"),c=L,g=S,u=N,l=A,m=j,C=I;return X(),J("div",null,[t(l,{gutter:20,justify:"end"},{default:n(()=>[t(u,{sm:24,md:12,lg:8},{default:n(()=>[e[3]||(e[3]=k("label",null,"天数：",-1)),t(_,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=s=>o.value=s),min:1,max:365},null,8,["modelValue"]),e[4]||(e[4]=D("   ",-1)),t(g,{type:"warning",onClick:i},{default:n(()=>[t(c,null,{default:n(()=>[t(y)]),_:1}),e[2]||(e[2]=D("   重新统计 ",-1))]),_:1})]),_:1})]),_:1}),t(l,{gutter:20},{default:n(()=>[t(u,{sm:24},{default:n(()=>[e[5]||(e[5]=k("label",null,"时间范围：",-1)),t(m,{modelValue:w(r),"onUpdate:modelValue":e[1]||(e[1]=s=>Z(r)?r.value=s:null),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),t(u,{sm:24},{default:n(()=>[t(w(Y),{class:"chart",option:w(p)},null,8,["option"])]),_:1}),t(u,{sm:24},{default:n(()=>[t(C,{model:"daily-count"})]),_:1})]),_:1})])}}}),re=T(te,[["__scopeId","data-v-33eba987"]]);export{re as default};
//# sourceMappingURL=DailyCount-laH4L8V2.js.map
