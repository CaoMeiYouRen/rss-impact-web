import{B as R,w as $,f as h,z as N,k as S,l as b,C as A,c as M,d as j,e as I,D as L,n as O,_ as T}from"./index-BNGuLPWh.js";/* empty css               */import{u as U,i as z,a as P,b as Q,c as q,d as F,E as G}from"./echarts-Ac_iK5Pg.js";import{g as k}from"./utils-D0r9SEbO.js";import{r as x,b as B,w as H,f as J,d as K,o as W,c as X,U as a,M as n,ai as Y,a as V,R as D,u as w,k as Z}from"./vendor-CuSlqIw8.js";import"./elementPlusIcons-DP5dCSo9.js";function tt(E,i,f){const _=x(),{loading:o,list:d,getOption:c,page:t,getList:y,option:g}=R(_,E,void 0,!1);t.value.pageSize=1e3;const m=$().hour(0).minute(0).second(0).millisecond(0),C=m.add(-31,"day"),r=m.add(1,"day").add(-1,"millisecond"),l=x([C.toDate(),r.toDate()]),p=B(()=>{var e;return((e=g.value.column)==null?void 0:e.filter(u=>f.includes((u==null?void 0:u.prop)||"")))||[]}),v=B(()=>({xAxis:{type:"category",data:d.value.map(e=>k(e,i))},yAxis:{type:"value"},series:p.value.map(e=>({data:d.value.map(u=>k(u,(e==null?void 0:e.prop)||"")),type:"line",name:e.label})),tooltip:{trigger:"axis"},legend:{data:p.value.map(e=>e.label),orient:"vertical",right:10,top:"center"}})),s=async()=>{const e=l.value[0],u=l.value[1];o.value=!0,await y({date:{$op:"Between",value:[e,u]}},{rawDate:"ASC",createdAt:void 0,id:void 0}),o.value=!1};return H([l],async()=>{await s()}),J(async()=>{await c(),await s()}),{loading:o,list:d,datetimerange:l,chartOption:v,onSearch:s}}const et=K({__name:"DailyCount",setup(E){U([z,P,Q,q,F]);const{datetimerange:i,chartOption:f,onSearch:_}=tt("daily-count","date",["articleCount","resourceCount","webhookLogCount","feedCount","categoryCount","hookCount","customQueryCount","proxyConfigCount","userCount"]),o=x(30);async function d(){try{await N.confirm(`确定重新统计 ${o.value} 天内的日志吗？此操作可以修复错误的统计数据，但不可回退！`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await S.api.dailyCountReCount({dayNum:o.value}),b.success("重新统计成功"),await _()}catch(c){if(console.error(c),c==="cancel")return;b.error("重新统计失败")}}return(c,t)=>{const y=A,g=Y("Refresh"),m=M,C=j,r=I,l=h,p=L,v=O;return W(),X("div",null,[a(l,{gutter:20,justify:"end"},{default:n(()=>[a(r,{sm:24,md:12,lg:8},{default:n(()=>[t[3]||(t[3]=V("label",null,"天数：",-1)),a(y,{modelValue:o.value,"onUpdate:modelValue":t[0]||(t[0]=s=>o.value=s),min:1,max:365},null,8,["modelValue"]),t[4]||(t[4]=D("   ")),a(C,{type:"warning",onClick:d},{default:n(()=>[a(m,null,{default:n(()=>[a(g)]),_:1}),t[2]||(t[2]=D("   重新统计 "))]),_:1})]),_:1})]),_:1}),a(l,{gutter:20},{default:n(()=>[a(r,{sm:24},{default:n(()=>[t[5]||(t[5]=V("label",null,"时间范围：",-1)),a(p,{modelValue:w(i),"onUpdate:modelValue":t[1]||(t[1]=s=>Z(i)?i.value=s:null),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),a(r,{sm:24},{default:n(()=>[a(w(G),{class:"chart",option:w(f)},null,8,["option"])]),_:1}),a(r,{sm:24},{default:n(()=>[a(v,{model:"daily-count"})]),_:1})]),_:1})])}}}),rt=T(et,[["__scopeId","data-v-6f3a90b0"]]);export{rt as default};
//# sourceMappingURL=DailyCount-B-rAqO0e.js.map
