{"version":3,"file":"Feed-CrWO-Zz7.js","sources":["../../src/views/data/Feed.vue"],"sourcesContent":["<template>\n    <div>\n        <el-collapse v-model=\"activeNames\">\n            <el-collapse-item name=\"1\">\n                <template #title>\n                    <h3>快速添加订阅</h3>\n                </template>\n                <CrudForm\n                    ref=\"crudFormDom\"\n                    url=\"/feed/quickCreate\"\n                    :pre-submit=\"preSave\"\n                    @success=\"onSuccess\"\n                    @reset-change=\"onReset\"\n                />\n            </el-collapse-item>\n            <el-collapse-item name=\"2\">\n                <template #title>\n                    <h3>从 OPML 文件导入</h3>\n                </template>\n                <CrudForm\n                    url=\"/feed/import\"\n                    :upload-after=\"onImportSuccess\"\n                    @success=\"onImportSuccess\"\n                />\n            </el-collapse-item>\n            <el-collapse-item name=\"3\">\n                <template #title>\n                    <h3>导出为 OPML 文件</h3>\n                </template>\n                <el-button type=\"primary\" @click=\"download\">\n                    <el-icon><Download /></el-icon> 导出\n                </el-button>\n            </el-collapse-item>\n        </el-collapse>\n\n        <CrudList\n            ref=\"crudListDom\"\n            model=\"feed\"\n            alias=\"feed\"\n            :post-get=\"postGet\"\n            :pre-save=\"preSave\"\n            :pre-update=\"preUpdate\"\n        />\n    </div>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ElMessage } from 'element-plus'\nimport { shallowRef, watch, ref } from 'vue'\nimport { useRoute } from 'vue-router'\nimport { saveAs } from 'file-saver'\nimport { useIdTransformer } from '@/hooks/use-id-transformer'\nimport CrudForm from '@/components/CrudForm.vue'\nimport CrudList from '@/components/CrudList.vue'\nimport { api } from '@/api'\nimport { getSafeFileName } from '@/utils/helper'\nimport { timeFormat } from '@/utils/time'\n\nconst route = useRoute()\n\nconst { postGet, preSave, preUpdate } = useIdTransformer(['hooks', 'customQueries'])\nconst crudFormDom = shallowRef<InstanceType<typeof CrudForm> | null>(null)\nconst crudListDom = shallowRef<InstanceType<typeof CrudList> | null>(null)\nconst activeNames = ref(['1'])\n\nconst onSuccess = async () => {\n    ElMessage.success('添加成功！')\n    await crudListDom.value?.updateDic()\n    await crudListDom.value?.refreshChange()\n\n}\n\nconst onReset = async () => {\n    crudFormDom.value?.initForm()\n}\n\nconst onImportSuccess = async () => {\n    ElMessage.success('添加成功！')\n    await crudListDom.value?.updateDic()\n    await crudListDom.value?.refreshChange()\n\n}\n\nconst download = async () => {\n    try {\n        const content = await api.api.feedExportByOpml()\n        const blob = new Blob([content], { type: 'application/xml; charset=utf-8' })\n        const filename = getSafeFileName(`rss-impact-${timeFormat(new Date(), 'YYYYMMDDHHmmss')}`)\n        saveAs(blob, `${filename}.xml`)\n        ElMessage.success('导出成功！')\n    } catch (error) {\n        ElMessage.error('导出失败！')\n    }\n}\n\nwatch(\n    () => route.path,\n    async () => {\n        if (route.path.includes('/feed')) {\n            await crudFormDom.value?.updateDic()  // 显示当前页面时刷新字典，解决新增用户等字典未更新问题\n        }\n    },\n)\n\n</script>\n\n<style lang=\"scss\" scoped>\n</style>\n"],"names":["route","useRoute","postGet","preSave","preUpdate","useIdTransformer","crudFormDom","shallowRef","crudListDom","activeNames","ref","onSuccess","ElMessage","_a","_b","onReset","onImportSuccess","download","content","api","blob","filename","getSafeFileName","timeFormat","saveAs","watch"],"mappings":"ibA0DA,MAAMA,EAAQC,EAAS,EAEjB,CAAE,QAAAC,EAAS,QAAAC,EAAS,UAAAC,CAAA,EAAcC,EAAiB,CAAC,QAAS,eAAe,CAAC,EAC7EC,EAAcC,EAAiD,IAAI,EACnEC,EAAcD,EAAiD,IAAI,EACnEE,EAAcC,EAAI,CAAC,GAAG,CAAC,EAEvBC,EAAY,SAAY,SAC1BC,EAAU,QAAQ,OAAO,EACnB,OAAAC,EAAAL,EAAY,QAAZ,YAAAK,EAAmB,aACnB,OAAAC,EAAAN,EAAY,QAAZ,YAAAM,EAAmB,gBAE7B,EAEMC,EAAU,SAAY,QACxBF,EAAAP,EAAY,QAAZ,MAAAO,EAAmB,UACvB,EAEMG,EAAkB,SAAY,SAChCJ,EAAU,QAAQ,OAAO,EACnB,OAAAC,EAAAL,EAAY,QAAZ,YAAAK,EAAmB,aACnB,OAAAC,EAAAN,EAAY,QAAZ,YAAAM,EAAmB,gBAE7B,EAEMG,EAAW,SAAY,CACrB,GAAA,CACA,MAAMC,EAAU,MAAMC,EAAI,IAAI,iBAAiB,EACzCC,EAAO,IAAI,KAAK,CAACF,CAAO,EAAG,CAAE,KAAM,iCAAkC,EACrEG,EAAWC,EAAgB,cAAcC,MAAe,KAAQ,gBAAgB,CAAC,EAAE,EAClFC,EAAAA,OAAAJ,EAAM,GAAGC,CAAQ,MAAM,EAC9BT,EAAU,QAAQ,OAAO,OACb,CACZA,EAAU,MAAM,OAAO,CAAA,CAE/B,EAEA,OAAAa,EACI,IAAMzB,EAAM,KACZ,SAAY,OACJA,EAAM,KAAK,SAAS,OAAO,GACrB,OAAAa,EAAAP,EAAY,QAAZ,YAAAO,EAAmB,YAC7B,CAER"}