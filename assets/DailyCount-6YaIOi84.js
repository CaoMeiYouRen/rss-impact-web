import{B as S,w as $,d as h,e as A,C as N,f as R,E as I,D as j,q as L,A as M,l as O,m as b,_ as T}from"./index-CsFvUKWI.js";/* empty css               */import{u as U,i as q,a as z,b as J,c as P,d as Q,E as F}from"./echarts-o5quzsjo.js";import{g as B}from"./utils-CWUwXfBd.js";import{r as x,b as V,w as G,f as H,d as K,c as W,I as t,J as n,am as X,o as Y,a as k,S as D,k as Z,u as w}from"./vendor-BLEnSRVx.js";import"./elementPlusIcons-Bcv3OZtk.js";function ee(E,r,p){const f=x(),{loading:o,list:i,getOption:d,page:e,getList:_,option:y}=S(f,E,void 0,!1);e.value.pageSize=1e3;const c=$().hour(0).minute(0).second(0).millisecond(0),g=c.add(-31,"day"),u=c.add(1,"day").add(-1,"millisecond"),l=x([g.toDate(),u.toDate()]),m=V(()=>y.value.column?.filter(a=>p.includes(a?.prop||""))||[]),C=V(()=>({xAxis:{type:"category",data:i.value.map(a=>B(a,r))},yAxis:{type:"value"},series:m.value.map(a=>({data:i.value.map(v=>B(v,a?.prop||"")),type:"line",name:a.label})),tooltip:{trigger:"axis"},legend:{data:m.value.map(a=>a.label),orient:"vertical",right:10,top:"center"}})),s=async()=>{const a=l.value[0],v=l.value[1];o.value=!0,await _({date:{$op:"Between",value:[a,v]}},{rawDate:"ASC",createdAt:void 0,id:void 0}),o.value=!1};return G([l],async()=>{await s()}),H(async()=>{await d(),await s()}),{loading:o,list:i,datetimerange:l,chartOption:C,onSearch:s}}const te=K({__name:"DailyCount",setup(E){U([q,z,J,P,Q]);const{datetimerange:r,chartOption:p,onSearch:f}=ee("daily-count","date",["articleCount","resourceCount","webhookLogCount","feedCount","categoryCount","hookCount","customQueryCount","proxyConfigCount","userCount"]),o=x(30);async function i(){try{await M.confirm(`确定重新统计 ${o.value} 天内的日志吗？此操作可以修复错误的统计数据，但不可回退！`,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await O.api.dailyCountReCount({dayNum:o.value}),b.success("重新统计成功"),await f()}catch(d){if(console.error(d),d==="cancel")return;b.error("重新统计失败")}}return(d,e)=>{const _=N,y=X("Refresh"),c=I,g=R,u=A,l=h,m=j,C=L;return Y(),W("div",null,[t(l,{gutter:20,justify:"end"},{default:n(()=>[t(u,{sm:24,md:12,lg:8},{default:n(()=>[e[3]||(e[3]=k("label",null,"天数：",-1)),t(_,{modelValue:o.value,"onUpdate:modelValue":e[0]||(e[0]=s=>o.value=s),min:1,max:365},null,8,["modelValue"]),e[4]||(e[4]=D("   ",-1)),t(g,{type:"warning",onClick:i},{default:n(()=>[t(c,null,{default:n(()=>[t(y)]),_:1}),e[2]||(e[2]=D("   重新统计 ",-1))]),_:1})]),_:1})]),_:1}),t(l,{gutter:20},{default:n(()=>[t(u,{sm:24},{default:n(()=>[e[5]||(e[5]=k("label",null,"时间范围：",-1)),t(m,{modelValue:w(r),"onUpdate:modelValue":e[1]||(e[1]=s=>Z(r)?r.value=s:null),type:"datetimerange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])]),_:1}),t(u,{sm:24},{default:n(()=>[t(w(F),{class:"chart",option:w(p)},null,8,["option"])]),_:1}),t(u,{sm:24},{default:n(()=>[t(C,{model:"daily-count"})]),_:1})]),_:1})])}}}),re=T(te,[["__scopeId","data-v-33eba987"]]);export{re as default};
//# sourceMappingURL=DailyCount-6YaIOi84.js.map
